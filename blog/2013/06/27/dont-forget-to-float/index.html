
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Don't Forget to Float - My Octopress Blog</title>
  <meta name="author" content="Sarah Duve">

  
  <meta name="description" content="So here&rsquo;s a riddle for you. When do New York&rsquo;s 300+ Citibike stations look like this? Answer: The same time 5 / 2 = 2 (i.e. when you& &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sarahduve.github.io/blog/2013/06/27/dont-forget-to-float">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41721030-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sarahduve.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Don't Forget to Float</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-27T17:39:00-04:00" pubdate data-updated="true">Jun 27<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>So here&rsquo;s a riddle for you. When do New York&rsquo;s 300+ Citibike stations look like this?
<img src="/images/float_map.png" title="Something's wrong here." alt="a funny map" />
Answer: The same time 5 / 2 = 2 (i.e. when you&rsquo;re doing integer math in Ruby).</p>

<p>But allow me to step back a bit. The above map arose during the hacking portion of the awesome Citibike Civic Hacknight held last night by <a href="http://www.meetup.com/betanyc/">BetaNYC</a> (and co-hosted by Flatiron TA <a href="https://twitter.com/ag_dubs">Ashley</a>!). While Citibike has yet to release a public API (though I&rsquo;m told that&rsquo;s imminent), developers have been able to expose a JSON <a href="http://citibikenyc.com/stations/json">API endpoint</a> in Citibike&rsquo;s source code that gives a live snapshot of the status at all stations. By continually scraping this data, some people have been able to put together <a href="http://sites.google.com/site/citibikestats/">some</a> <a href="http://experimenting.alastair.is/citibike/">pretty</a> <a href="http://data.citibik.es/">cool</a> <a href="http://citibikedata.com/">things</a>, many of which were presented last night. One of the highlights for me came not from a hacker or data scientist, but from Anthony Townsend, a research fellow at NYU&rsquo;s Rudin Center. Anthony explored the possibility of redesigning neighborhoods around Citibike, using it to effectively spread the value of the subway over a larger area, and thus drawing New Yorkers into farther-flung corners of the city. You can view his deck <a href="http://www.slideshare.net/anthonymobile/bike-hack-night-townsend">here</a>.</p>

<p>Back to the hacking!</p>

<p>Ashley was kind enough to put together a little mini lab for the small group of Flatiron students that attended. We used the <a href="https://rubygems.org/gems/multi_json">MultiJSON</a> gem to parse a snapshot of the station feed, turning it into a Ruby hash for us to play with. Since we were just getting started with Citibike data and didn&rsquo;t have weeks of scrapes to work with, plotting the stations on a map seemed like a good simple exercise to start with. We set to work implementing that with <a href="http://leafletjs.com/">Leaflet</a> but quickly realized that on its way to becoming a Ruby hash, our JSON data had undergone a few changes. Namely, our GPS coordinates, which previously had eight decimal places, were now eight digit integers.</p>

<script src="https://gist.github.com/sarahduve/92415a43a74b9092339c.js"></script>




<script src="https://gist.github.com/sarahduve/4392058dba9dae6ab812.js"></script>


<p>Okay, no problem &ndash; easy fix, right?</p>

<script src="https://gist.github.com/sarahduve/2bfc53469d82d6ebe9b0.js"></script>


<p>Not so fast. For those of you who have already figured out the problem here, please bear with me because I&rsquo;m about to explain the meandering route I took to get there.</p>

<p>Part of the problem with our code at this point was that it made it look like only two sets of our coordinates were being plotted, when we should have been iterating over more than 300. I spent a lot of time staring at this, trying to figure out what else could have potentially gotten lost in the JSON translation, and what other data points these markers could inadvertently be representing. Some key names underwent some minor changes (e.g. &ldquo;latitude&rdquo; to &ldquo;lat&rdquo;), but otherwise nothing stood out as too glaring, so I decided to take a closer look at the two actual locations.</p>

<iframe width="375" height="300" frameborder="20" scrolling="no" marginheight="10" marginwidth="10" src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=40,+-75&amp;aq=&amp;sll=40,-74&amp;sspn=0.128081,0.32341&amp;ie=UTF8&amp;t=m&amp;z=14&amp;ll=40,-75&amp;output=embed"></iframe>


<br /><small><a href="https://maps.google.com/maps?f=q&amp;source=embed&amp;hl=en&amp;geocode=&amp;q=40,+-75&amp;aq=&amp;sll=40,-74&amp;sspn=0.128081,0.32341&amp;ie=UTF8&amp;t=m&amp;z=14&amp;ll=40,-75" style="color:#0000FF;text-align:right"></a></small> 




<iframe width="375" height="300" frameborder="10" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=40,+-74&amp;aq=&amp;sll=40.697488,-73.979681&amp;sspn=0.507051,1.29364&amp;ie=UTF8&amp;t=m&amp;z=12&amp;ll=40,-74&amp;output=embed"></iframe>


<br /><small><a href="https://maps.google.com/maps?f=q&amp;source=embed&amp;hl=en&amp;geocode=&amp;q=40,+-74&amp;aq=&amp;sll=40.697488,-73.979681&amp;sspn=0.507051,1.29364&amp;ie=UTF8&amp;t=m&amp;z=12&amp;ll=40,-74" style="color:#0000FF;text-align:left"></a></small>


<p>Hmmm, so the one thing these seem to have in common is their perfectly rounded coordinates&hellip;perfectly rounded&hellip;hmmm&hellip;this sounds&hellip;familiar.</p>

<p>Time to do something I should have done a long time ago.</p>

<p><img src="/images/integer.png" title="That's not right!" alt="integer math" /></p>

<p>Ah ha!</p>

<p>If you use integers in Ruby arithmetic, you get integer answers. As it turns out, those &ldquo;two markers&rdquo; were actually all 300+ stations, directly on top of each other. When rounded, all became either 40, -75 or 40, -74.  If you want floats (i.e. decimals), you need to use them in the operation whether by adding decimal places yourself or converting with <code>.to_f</code>.</p>

<p><img src="/images/float.png" title="There we go!" alt="float" /></p>

<p>Problem solved.
<img src="/images/real_map.png" title="That's more like it" alt="a real map" /></p>

<p>This is some very basic Ruby math that we all learn early on, but can easily forget because we generally don&rsquo;t have much reason to use floats in our programs (40.742354 artists in your playlist, anyone?). And it&rsquo;s not often that we get such a cool visualization of this common error, so I&rsquo;m kind of glad this happened. Between the maps and this post, here&rsquo;s betting I don&rsquo;t make it again!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sarah Duve</span></span>

      








  


<time datetime="2013-06-27T17:39:00-04:00" pubdate data-updated="true">Jun 27<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://sarahduve.github.io/blog/2013/06/27/dont-forget-to-float/" data-via="" data-counturl="http://sarahduve.github.io/blog/2013/06/27/dont-forget-to-float/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/06/17/the-place-of-flash-cards/" title="Previous Post: The Place of Flash Cards">&laquo; The Place of Flash Cards</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/06/27/dont-forget-to-float/">Don't Forget to Float</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/17/the-place-of-flash-cards/">The Place of Flash Cards</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/13/why-im-learning-to-code/">Why I'm Learning to Code</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Sarah Duve -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
